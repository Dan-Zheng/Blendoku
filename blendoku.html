<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>MR461</title>
    <script type="text/javascript" src="js/phaser.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script type="text/javascript" src="js/jquery.xcolor.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">


//Sets up Phaser Game
var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update, render: render });

//Defining variables makes chaning color later on much easier. Better dynamic code
var red="#FF0000";
var blue="#0015FF";
var green="#1EFF00";
var yellow="#FFDC0B";

//Array used to set position of the bases. It is also used to set the stage size
//[stage.x,stage.y, firstBase.x, firstBase.y, secondBase.x, secondBase.y, etc]
var cords = [1000,1000,125,500,275,500,425,500,575,500,725,500];

//Array used to set colors of the bases.
var color = ["#69D2E7", "#FFFFFF", "#FFFFFF", "#FFFFFF", "#FFFFFF", "#696969"];

//Array used to set health of bases.
var health=[1.00,.7,.3,.2,.6];
var sprite;
var bmd;

function preload() {
    game.load.image('arrow', 'assets/star.png');
}

//Dynamically draws circles based on how many coordinates are provided in the cords arry
//Dynamically colors bases based on color[].
//Function used later in create() and update()
function draw(){
    var x=0;
    var y;
    for (i=2; i<cords.length; i++){
        if(i%2==0){
            drawCircle(cords[i],cords[i+1],65,0,Math.PI*2*health[x-1], color[x]);
            y=$.xcolor.darken(color[x],1,80);
            drawCircle(cords[i],cords[i+1],55,0,Math.PI*2,y.getHex());
            if(x<color.length){
                x++;
            }
        }
    }
}

function create() {
    draw();
    //Draws the circles and lines to the canvas
    /*game.time.events.loop(500, function() {
            draw();
            
            health[0] -= 0.01;
        }, this);*/
    
    //DISCLAIMER START: We're not exactly sure how the physics works yet. The code is just copied and pasted from phaser samples

    game.physics.startSystem(Phaser.Physics.ARCADE);

    sprite = game.add.sprite(400, 300, 'arrow');
    sprite.anchor.setTo(0.5, 0.5);

    //  Enable Arcade Physics for the sprite
    game.physics.enable(sprite, Phaser.Physics.ARCADE);

    //  Tell it we don't want physics to manage the rotation
    sprite.body.allowRotation = false;
    
    //END DISCLAIMER
}

function update() {

}

function render(){
    game.debug.text(game.time.fps || '--', 2, 14, "#00ff00"); 
    
}

//Might be of use later.
//Copied from http://www.allworkallplay.org/blog/orbital-debris-making-an-html5-game-with-phaser/
function spawnNewOrbiter(graphic) {
    var orbiter = game.add.sprite(0, 0, graphic);
    orbiter.anchor.setTo(0.5, 0.5);
    orbiter.moveData = {};
    orbiter.moveData.altitude = 0;
    orbiter.moveData.altitudeTarget = 0;
    orbiter.moveData.altitudeChangeRate = 0;
    orbiter.moveData.altitudeMin = 0;
    orbiter.moveData.altitudeMax = 0;
    orbiter.moveData.orbit = 0;
    orbiter.moveData.orbitRate = 0;
    orbiterGroup.add(orbiter);
    return orbiter;
}

function drawCircle(x, y, radius, startAngle, endAngle, color){
    // Draw arc: (x, y, radius, startAngle, endAngle, clockwise)
        // Create BitmapData
        bmd = game.add.bitmapData(800,600);

        // Draw circle
        bmd.ctx.fillStyle = color;
        bmd.ctx.beginPath();
        bmd.ctx.arc(x, y, radius, startAngle, endAngle, false); 
        bmd.ctx.lineTo(x ,y);
        bmd.ctx.closePath();
        bmd.ctx.fill();

        // Put BitmapData in a Sprite
        circleSprite = game.add.sprite(0, 0, bmd);
}


function shadeColor(color, percent) {
    // Shades a color by a percentage, used to dynamically darken base arc color   
    var f=parseInt(color.slice(1),16);
    var t=percent<0?0:255;
    var p=percent<0?percent*-1:percent;
    var R=f>>16;
    var G=f>>8&0x00FF;
    var B=f&0x0000FF;
    return "#"+(0x1000000+(Math.round((t-R)*p)+R)*0x10000+(Math.round((t-G)*p)+G)*0x100+(Math.round((t-B)*p)+B)).toString(16).slice(1);
}

</script>

</body>
</html>